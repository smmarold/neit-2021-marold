<!DOCTYPE html>
<html>
<head>
<title>AJAX Assignment</title>
	<style type="text/css">
		section{	
			margin-bottom:25px;
		}
		section section{
			width:100%;
			float:left;
			border:1px solid black;
		}
		#main-content section{
			width:33%;
			float:left;
		}
		#main-content{
			margin-bottom:25px;
		}
	</style>
</head>
<body>
	<div id="main-content">
		<!--
			Find the highest paid employee for each job listed below
			Then use JavaScript to fill in the information
		-->
		<!--Once you are done filling in all of the jobs, you will turn the highest average salary green -->
		<section id="database-analyst-area" >
			<h2>Database Analyst | Highest Paid</h2>
			<h3>First Name:</h3>
			<div class="first"><!--The first name goes here--></div>
			<h3>Last Name:</h3>
			<div class="last"><!--The last name goes here--></div>
			<h3>Salary:</h3>
			<div class="salary"><!--The salary goes here--></div>
			<h3>Average Salary:</h3>
			<h3 class="average"><!--The average salary for all database-analysts goes here--></h3>
			
		</section>
     
		<section  id="web-developer-area" >
			<h2>Web Developer | Highest Paid </h2>
			<h3>First Name:</h3>
			<div class="first"></div>
			<h3>Last Name:</h3>
			<div class="last"></div>
			<h3>Salary:</h3>
			<div class="salary"></div>
			<h3>Average Salary:</h3>
			<h3 class="average"></h3>

		</section >

		<section  id="software-developer-area">
			<h2>Software Developer | Highest Paid </h2>
			<h3>First Name:</h3>
			<div class="first"></div>
			<h3>Last Name:</h3>
			<div class="last"></div>
			<h3>Salary:</h3>
			<div class="salary"></div>
			<h3>Average Salary:</h3>
			<h3 class="average"></h3>
		</section >
	</div>
	
	<!--Use the form inputs to search for employees. Then display the employees information in the #output <div>-->
	<section  id="search-area">
		<input type="text" placeholder="First Name" id="first-name">
		<input type="text" placeholder="Last Name" id="last-name">
		<input type="button" id="search-submit" value="search">
		<section id="search-output">
			<h2>Search Output</h2>
			<div class="output">
				<!--Output search info to here.-->
			</div>
		</section>
	</section >

	<!--Use the button inputs to display a list of everyone in that job-->
	<section  id="list-area">
		<input type="button" value="List Database Analysts" id="list-database-analyst">
		<input type="button" value="List Web Developers" id="list-web-developer">
		<input type="button" value="List Software Developers" id="list-software-developers" >
		<section id="list-output">
			<h2>List Output</h2>
			<div class="output">
				<!--Output list info to here.-->
			</div>
		</section>
	</section >

</body>
</html>

<script>
	//getting section elements
	databaseAnalyst = document.querySelector('#database-analyst-area')
	webDev = document.querySelector('#web-developer-area')
	softwareDev = document.querySelector('#software-developer-area')
	searchArea = document.querySelector('#search-area')
	listArea = document.querySelector('#list-area')
	dataButton = listArea.querySelector('#list-database-analyst')
	webButton = listArea.querySelector('#list-web-developer')
	softButton = listArea.querySelector('#list-software-developers')

	//fetch data, store as jobs
	fetch('https://neit-se266-class.herokuapp.com/salaries.php')
  	.then(response => response.json())
	.then(jobs => {

		//Vars. Need objocts for storing which is highest, and parallel arrays for getting avgs later. 
		let highestDatabaseJob = {"salary":0};
		let highestWebJob = {"salary":0};
		let highestSoftwareJob = {"salary":0};
		let avgSalaries = [0,0,0]
		//Var for storing objects separated by job. 
		let dataJobs = [];
		let webJobs = [];
		let softJobs = [];

		//loop through each job. Use Switch to check which jobTitle is in each obj. Increment num jobs for that jobTitle, 
		// Add salary to avgSalaries for avgs later. Then, if the salary is higher than the previous one, store it in appropriate Var. 
		for(let i = 0; i<jobs.length; i++)
		{
			switch(jobs[i].jobTitle)
			{
				case 'Database Analyst':
					dataJobs.push(jobs[i])
					avgSalaries[0] += parseInt(jobs[i].salary)
					if(jobs[i].salary > highestDatabaseJob.salary)
						highestDatabaseJob = jobs[i];
					break;
				case 'Web Developer':
					webJobs.push(jobs[i])
					avgSalaries[1] += parseInt(jobs[i].salary)
					if(jobs[i].salary > highestWebJob.salary)
						highestWebJob = jobs[i];
					break;
				case 'Software Developer':
					softJobs.push(jobs[i])
					avgSalaries[2] += parseInt(jobs[i].salary)
					if(jobs[i].salary > highestSoftwareJob.salary)
						highestSoftwareJob = jobs[i];
					break;
			}
			
		}
		
		//Get avg Salaries for each job title, then get max of those and store in Var for 
		let numJobs = [dataJobs, webJobs, softJobs]
		for(let i = 0; i<3; i++)
		{
			avgSalaries[i] /= numJobs[i].length
		}
		let highestAvgSalary = Math.max(...avgSalaries);

		//Fill the page with our relevant info. 
		fillHighestPaidJobs(databaseAnalyst, highestDatabaseJob, avgSalaries[0], highestAvgSalary);
		fillHighestPaidJobs(webDev, highestWebJob, avgSalaries[1], highestAvgSalary);
		fillHighestPaidJobs(softwareDev, highestSoftwareJob, avgSalaries[2], highestAvgSalary);

		//Search Section Code. 
		searchArea.querySelector('#search-submit').addEventListener('click', (e)=> {
			let firstName = searchArea.querySelector('#first-name').value
			let lastName = searchArea.querySelector('#last-name').value

			//loop through Data, find a match for the first and last names, display that persons info. 
			for(let i=0; i<jobs.length; i++)
			{
				if(firstName.includes(jobs[i].name.first) && lastName.includes(jobs[i].name.last))
				{	
					 let output = `<p>Name: ${jobs[i].name.first} ${jobs[i].name.last}<p>
						<p>Job Title: ${jobs[i].jobTitle}<p>
						<p>Salary: ${jobs[i].salary}<p>`
					searchArea.querySelector('div.output').innerHTML = output
				}
			}
		})

		//List By Job code
		let buttons = [dataButton, webButton, softButton]
		for(let i=0; i<3; i++)
		{
			buttons[i].addEventListener('click', (e)=>{
				let listOutput = '<h1>Results</h1>';
				for(let j = 0; j<numJobs[i].length; j++)
				{
					listOutput += `<p>Name: ${numJobs[i][j].name.first} ${numJobs[i][j].name.last}<p>
						<p>Job Title: ${numJobs[i][j].jobTitle}<p>
						<p>Salary: ${numJobs[i][j].salary}<p>`
				}
				listArea.querySelector('div.output').innerHTML = listOutput
			})
		}
	})


	//Because each div had the same class, I created this function and just called it for each section. 
	//Takes section, highest paid job and average salary object for each section, as well as the highest of the three for 
	//checking if we turn it green or not. 
	function fillHighestPaidJobs(sectionElement, job, avgSal, highestAvgSal)
	{
		sectionElement.querySelector('div.first').innerHTML = job.name.first
		sectionElement.querySelector('div.last').innerHTML = job.name.last
		sectionElement.querySelector('div.salary').innerHTML = job.salary
		sectionElement.querySelector('h3.average').innerHTML = avgSal.toFixed(2)
		if(avgSal == highestAvgSal)
		{
			sectionElement.querySelector('h3.average').style.color = 'green'
			sectionElement.style.border = '1px solid green'
		}
			
	}
</script>